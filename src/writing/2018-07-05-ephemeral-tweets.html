---
title: "Ephemeral Tweets with Node and Webtask"
css: highlight.css
---

<p>A couple of weeks ago I stumbled upon this article by Vicky Lai called <a href="https://victoria.dev/verbose/why-im-automatically-deleting-my-old-tweets-using-aws-lambda/">Why I’m automatically deleting my old tweets using AWS Lambda</a>. It hit me at a time when I just started to rekindle my love for minimalism and digital detox and I was immediately intrigued with the thought of making my tweets ephemeral, i.e. deleting them after a certain number of days. Because, let’s face it, a tweet from way back then should not have the power to let other people make assumptions on who you are today.</p>

<blockquote>
  <p>We change our opinions, our desires, our habits. We are not stagnant beings, and we should not let ourselves be represented as such, however unintentionally.</p>
</blockquote>

<p>After looking at <a href="https://github.com/vickylai/ephemeral">Vicky’s Go code</a> I got excited to try this in Node and use <a href="https://webtask.io/">Webtask</a> to host my <a href="https://github.com/stephanmax/ephemeral-tweets">ephemeral-tweets</a> microservice.</p>

<h2>The Code</h2>

<p>The code for ephemeral-tweets is written in ES6 and uses features like <code>const</code>, fat arrow functions, destructuring, and promises. I also use Webtask’s <a href="https://webtask.io/docs/editor/secrets">secrets</a> (similar to environment variables, exposed via the microservice’s <code>context</code> parameter) for private Twitter credentials and the maximum age of the tweets you want to keep, represented in days.</p>

[code language="javascript"]
module.exports = function(context, done) {
  const maxTweetAge = context.secrets.MAX_TWEET_AGE * dayInMs

  const twitterClient = new Twitter({
    consumer_key: context.secrets.CONSUMER_KEY,
    consumer_secret: context.secrets.CONSUMER_SECRET,
    access_token: context.secrets.ACCESS_TOKEN,
    access_token_secret: context.secrets.ACCESS_TOKEN_SECRET
  })

  ...
}
[/code]

<p>I use the <a href="https://github.com/ttezel/twit">twit library</a> to connect to and query the Twitter API, mainly because it offers all the convenience methods you would expect, supports promises, and exposes the full response object (for watching rate limits, for example).</p>

<p>The ephemeral-tweets microservice retrieves 200 tweets per call from your timeline (as per Twitter’s API limit for <a href="https://developer.twitter.com/en/docs/tweets/timelines/api-reference/get-statuses-user_timeline.html">GET statuses/user_timeline</a>, filters them by <code>MAX_TWEET_AGE</code> and deletes the ones that are older.</p>

<p>In case you wondered why I left the <code>console.log</code> calls in there: Depending on how you develop your task (whether locally or inside the <a href="https://webtask.io/docs/editor/logs">Webtask Editor</a>) Webtask pipes <code>console.log</code> output to the console or to the editor’s log panel which is great help during development.</p>

[code language="javascript"]
...

twitterClient.get('statuses/user_timeline', {
  count: 200
})
.then(({data: tweets}) => {
  let deleteRequests = tweets
    .filter(tweet => {
      return new Date() - new Date(tweet.created_at) > maxTweetAge
    })
    .map(tweet => {
      return new Promise((resolve, reject) => {
        twitterClient.post('statuses/destroy/:id', {
          id: tweet.id_str
        })
        .then(({data: deletedTweet}) => {
          console.log(`Deleted tweet #${deletedTweet.id_str}: "${deletedTweet.text}"`)
          resolve(deletedTweet)
        })
        .catch(err => {
          console.log(err)
          reject(err)
        })
      })
    })

  return Promise.all(deleteRequests)
})
.then(deletedTweets => {
  console.log(`Done. Deleted ${deletedTweets.length} tweets.`)
  done(null, { deletedTweets })
})
.catch(done)
[/code]

<p>This is it! You can find <a href="https://github.com/stephanmax/ephemeral-tweets">the code on GitHub</a> and refer to the <a href="https://github.com/stephanmax/ephemeral-tweets#readme">README</a> for instructions on how to build, customize, schedule, and deploy this microservice for your own Twitter account.</p>

<h2>A Note on (Rate) Limits</h2>

<p>There are some limits I want to point out, especially to people with a lot of tweets on their timeline wanting to run this task often in the beginning:</p>

<ul>
  <li>Webtask will host this microservice for free as long as you stay below one call per second. Fair!</li>
  <li>You can retrieve your timeline tweets up to 900 times in 15 minutes (so once every second) with a maximum of 200 tweets per call. The 200 tweets are already hard-coded into ephemeral-tweets and the free tier of Webtask already limits you to one call per second, so you should be fine.</li>
  <li>Deleting tweets seems to have a rate limit (at least that’s what the <a href="https://developer.twitter.com/en/docs/tweets/post-and-engage/api-reference/post-statuses-destroy-id">API docs</a> imply), but I really did not understand how that looks like. I only found some limits for POST requests in the <a href="https://help.twitter.com/en/rules-and-policies/twitter-limits">Twitter Help Center</a>, but deleting tweets is not on the list. I never hit any limits for deleting tweets, but if you can shed some light on this please ping me on <a href="https://twitter.com/stephanmaxToGo">Twitter</a>.</li>
</ul>
